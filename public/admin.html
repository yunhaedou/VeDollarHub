<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - VeDollar Hub</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">

    <style>
        :root { --bg-color: #0f172a; --glass-bg: rgba(30, 41, 59, 0.7); --glass-border: 1px solid rgba(255, 255, 255, 0.1); --primary: #6366f1; --secondary: #a855f7; --text-main: #f8fafc; --text-muted: #94a3b8; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background-color: var(--bg-color); color: var(--text-main); padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 1px solid #334155; padding-bottom: 15px; }
        .glass-card { background: var(--glass-bg); border: var(--glass-border); border-radius: 16px; padding: 25px; margin-bottom: 25px; }
        h3 { margin-bottom: 15px; color: var(--primary); }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 12px; color: var(--text-muted); margin-bottom: 5px; }
        .input-field, select { width: 100%; background: rgba(15, 23, 42, 0.6); border: 1px solid #334155; padding: 10px; border-radius: 8px; color: #fff; outline: none; }
        .btn { padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-sync { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); color: white; width: 100%; }
        .btn-save { background: var(--primary); color: white; width: 100%; }
        .btn-del { background: #ef4444; color: white; padding: 5px 10px; font-size: 12px; }
        .btn:hover { opacity: 0.9; transform: translateY(-2px); }
        .product-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 13px; }
        .product-table th { text-align: left; color: var(--text-muted); padding: 10px; border-bottom: 1px solid #334155; }
        .product-table td { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .btn-back { background: transparent; border: 1px solid var(--text-muted); color: var(--text-muted); display: inline-block; margin-bottom: 20px; text-decoration: none; padding: 5px 15px; border-radius: 50px; font-size: 12px; }
    </style>
</head>
<body>

    <div class="container">
        <a href="index.html" class="btn-back"><i class="fas fa-arrow-left"></i> Kembali ke Toko</a>

        <div class="header">
            <h2>Admin Panel</h2>
            <div style="font-size: 12px; color: #94a3b8;">Kelola Produk & Hosting</div>
        </div>

        <div class="glass-card" style="border-left: 4px solid #22c55e;">
            <h3><i class="fas fa-sync-alt"></i> Get Layanan GriezStore</h3>
            <p style="font-size: 12px; color: #cbd5e1; margin-bottom: 15px;">
                Tarik otomatis data <b>Mobile Legends (Indo/Brazil)</b> dan <b>Weekly Diamond</b> dari GriezStore. Harga otomatis dimarkup Rp 1.500.
            </p>
            <button class="btn btn-sync" onclick="syncGriez()">
                <i class="fas fa-cloud-download-alt"></i> AMBIL LAYANAN SEKARANG
            </button>
        </div>

        <div class="glass-card" style="border-left: 4px solid var(--primary);">
            <h3><i class="fas fa-server"></i> Tambah Hosting Manual (Bot Only)</h3>
            <p style="font-size: 11px; color: #94a3b8; margin-bottom: 10px;">Khusus Bot WhatsApp / Telegram (Settingan Manual).</p>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <div class="form-group"><label>Nama Produk</label><input type="text" id="pName" class="input-field" placeholder="Contoh: Paket Bot Basic"></div>
                <div class="form-group"><label>Harga (Rp)</label><input type="number" id="pPrice" class="input-field" placeholder="15000"></div>
            </div>

            <div class="form-group">
                <label>Kategori</label>
                <select id="pCat" class="input-field">
                    <option value="botwa">Bot WhatsApp</option>
                    <option value="bottg">Bot Telegram</option>
                </select>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                <div class="form-group"><label>RAM (MB)</label><input type="number" id="pRam" class="input-field" value="1024"></div>
                <div class="form-group"><label>CPU (%)</label><input type="number" id="pCpu" class="input-field" value="100"></div>
                <div class="form-group"><label>Disk (MB)</label><input type="number" id="pDisk" class="input-field" value="1000"></div>
            </div>

            <button class="btn btn-save" onclick="addHostingProduct()"><i class="fas fa-plus"></i> Simpan Produk Bot</button>
        </div>

        <div class="glass-card">
            <h3>Daftar Produk Aktif</h3>
            <div style="overflow-x: auto;">
                <table class="product-table">
                    <thead><tr><th>Nama</th><th>Kategori</th><th>Harga</th><th>Aksi</th></tr></thead>
                    <tbody id="productList"><tr><td colspan="4" style="text-align:center;">Memuat...</td></tr></tbody>
                </table>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, orderBy, query } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCsUfb9HtWHcziy82aOCdkiOiJqeJ4y-34",
            authDomain: "vedollar-hub.firebaseapp.com",
            projectId: "vedollar-hub",
            storageBucket: "vedollar-hub.firebasestorage.app",
            messagingSenderId: "1091182084872",
            appId: "1:1091182084872:web:d38ba494182e8cebcba2bd",
            measurementId: "G-Y7JXCTLN9Q"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // SYNC GRIEZ
        window.syncGriez = async function() {
            const btn = document.querySelector('.btn-sync');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Proses Ambil Data...';
            btn.disabled = true;
            try {
                const res = await fetch('/api/sync-griez');
                const data = await res.json();
                if (data.success) showToast(data.message, "success");
                else showToast(data.error || "Gagal Sync", "error");
            } catch (error) { showToast("Error Server", "error"); } 
            finally { btn.innerHTML = originalText; btn.disabled = false; }
        };

        // ADD HOSTING MANUAL
        window.addHostingProduct = async function() {
            const name = document.getElementById('pName').value;
            const price = document.getElementById('pPrice').value;
            const cat = document.getElementById('pCat').value;
            const ram = document.getElementById('pRam').value;
            const cpu = document.getElementById('pCpu').value;
            const disk = document.getElementById('pDisk').value;

            if(!name || !price) return showToast("Isi nama & harga!", "error");

            try {
                await addDoc(collection(db, "products"), {
                    name, price: parseInt(price), category: cat,
                    description: `RAM ${ram}MB, CPU ${cpu}%`,
                    ram, cpu, disk, provider: 'manual'
                });
                showToast("Produk Hosting Ditambah!", "success");
                document.getElementById('pName').value = ""; document.getElementById('pPrice').value = "";
            } catch (e) { showToast(e.message, "error"); }
        };

        // LIST PRODUK
        const q = query(collection(db, "products"), orderBy("category"));
        onSnapshot(q, (snapshot) => {
            const tbody = document.getElementById('productList');
            tbody.innerHTML = "";
            if(snapshot.empty) { tbody.innerHTML = `<tr><td colspan="4" style="text-align:center;">Kosong.</td></tr>`; return; }
            snapshot.forEach((docSnap) => {
                const p = docSnap.data();
                const tr = document.createElement('tr');
                tr.innerHTML = `<td><b>${p.name}</b><br><small style="color:#64748b">${p.service_code || 'Manual'}</small></td>
                    <td><span style="background:#334155; padding:2px 6px; border-radius:4px; font-size:10px;">${p.category}</span></td>
                    <td>Rp ${p.price}</td>
                    <td><button class="btn btn-del" onclick="deleteProduct('${docSnap.id}')"><i class="fas fa-trash"></i></button></td>`;
                tbody.appendChild(tr);
            });
        });

        window.deleteProduct = async (id) => { if(confirm("Hapus?")) try { await deleteDoc(doc(db, "products", id)); showToast("Dihapus.", "success"); } catch(e){} };
        function showToast(msg, type) { Toastify({ text: msg, duration: 3000, gravity: "top", position: "center", backgroundColor: type === "success" ? "#22c55e" : "#ef4444" }).showToast(); }
    </script>
</body>
</html>
