<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - VeDollar Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <style>
        body { background: #0f172a; color: white; font-family: 'Poppins', sans-serif; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .card { background: rgba(30, 41, 59, 0.7); border: 1px solid rgba(255,255,255,0.1); padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        input, select, textarea { width: 100%; background: #1e293b; border: 1px solid #334155; padding: 10px; color: white; border-radius: 6px; margin-top: 5px; margin-bottom: 10px; }
        .btn { width: 100%; padding: 10px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .btn-green { background: #22c55e; color: white; }
        .btn-blue { background: #3b82f6; color: white; }
        .btn-red { background: #ef4444; color: white; width: auto; padding: 5px 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 13px; }
        th, td { text-align: left; padding: 8px; border-bottom: 1px solid #334155; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Admin Panel</h2>
        <a href="index.html" style="color:#94a3b8; text-decoration:none;">&larr; Kembali ke Toko</a><br><br>

        <div class="card" style="border-left: 4px solid #22c55e;">
            <h3><i class="fas fa-cube"></i> Tambah App Premium (Auto Stock)</h3>
            <p style="font-size:11px; color:#aaa">Format Stok: <code>akun1|pass|info : akun2|pass|info : akun3...</code> (Pemisah antar akun adalah titik dua <b>:</b> )</p>
            
            <label>Nama App</label>
            <input type="text" id="appName" placeholder="Contoh: Netflix Premium 1 Bulan">
            
            <label>Harga (Rp)</label>
            <input type="number" id="appPrice" placeholder="25000">

            <label>Data Stok (Pisahkan dengan : )</label>
            <textarea id="appStock" rows="4" placeholder="a@email.com|pass|link : b@email.com|pass|link"></textarea>

            <button class="btn btn-green" onclick="addAppProduct()">Simpan App Premium</button>
        </div>

        <div class="card" style="border-left: 4px solid #3b82f6;">
            <h3><i class="fas fa-server"></i> Tambah Bot / VPS</h3>
            <label>Nama Layanan</label>
            <input type="text" id="hostName" placeholder="Contoh: VPS 2GB / Bot WhatsApp">
            
            <label>Harga (Rp)</label>
            <input type="number" id="hostPrice" placeholder="15000">
            
            <label>Kategori</label>
            <select id="hostCat">
                <option value="botwa">Bot WhatsApp (Auto Create)</option>
                <option value="bottg">Bot Telegram (Auto Create)</option>
                <option value="vps">VPS (Manual via WA)</option>
            </select>

            <label>RAM (MB) - Abaikan jika VPS</label>
            <input type="number" id="hostRam" value="1024">

            <button class="btn btn-blue" onclick="addHostProduct()">Simpan Layanan</button>
        </div>

        <div class="card">
            <h3>Daftar Produk</h3>
            <table id="prodTable">
                <thead><tr><th>Nama</th><th>Kat</th><th>Harga</th><th>Stok</th><th>Aksi</th></tr></thead>
                <tbody><tr><td colspan="5">Memuat...</td></tr></tbody>
            </table>
        </div>
    </div>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const db = getFirestore(initializeApp({
            apiKey: "AIzaSyCsUfb9HtWHcziy82aOCdkiOiJqeJ4y-34",
            authDomain: "vedollar-hub.firebaseapp.com",
            projectId: "vedollar-hub"
        }));

        // TAMBAH APP PREMIUM
        window.addAppProduct = async () => {
            const name = document.getElementById('appName').value;
            const price = document.getElementById('appPrice').value;
            const rawStock = document.getElementById('appStock').value;

            if(!name || !price || !rawStock) return alert("Lengkapi data!");

            // LOGIKA SPLIT STOK BERDASARKAN ":"
            const stockArray = rawStock.split(':').map(s => s.trim()).filter(s => s !== "");

            try {
                await addDoc(collection(db, "products"), {
                    name, price: parseInt(price), category: 'app',
                    stock: stockArray, // Simpan sebagai Array
                    description: "Pengiriman Otomatis"
                });
                Toastify({text: `Sukses! ${stockArray.length} stok ditambahkan.`, backgroundColor: "green"}).showToast();
                document.getElementById('appName').value = ""; document.getElementById('appStock').value = "";
            } catch(e) { alert(e.message); }
        };

        // TAMBAH HOSTING/VPS
        window.addHostProduct = async () => {
            const name = document.getElementById('hostName').value;
            const price = document.getElementById('hostPrice').value;
            const cat = document.getElementById('hostCat').value;
            const ram = document.getElementById('hostRam').value;

            if(!name || !price) return alert("Lengkapi data!");

            try {
                await addDoc(collection(db, "products"), {
                    name, price: parseInt(price), category: cat,
                    description: cat === 'vps' ? 'Proses Manual via WA' : `RAM ${ram}MB (Auto)`,
                    ram: parseInt(ram), cpu: 100, disk: 1000
                });
                Toastify({text: "Sukses tambah layanan.", backgroundColor: "blue"}).showToast();
            } catch(e) { alert(e.message); }
        };

        // LIST
        onSnapshot(query(collection(db, "products"), orderBy("category")), (snap) => {
            const tb = document.querySelector('#prodTable tbody');
            tb.innerHTML = "";
            snap.forEach(d => {
                const p = d.data();
                let stockDisplay = "-";
                
                // Tampilkan jumlah stok jika App Premium
                if(p.category === 'app') {
                    const count = p.stock ? p.stock.length : 0;
                    stockDisplay = count > 0 ? `<b style="color:#4ade80">${count}</b>` : `<b style="color:red">HABIS</b>`;
                }

                tb.innerHTML += `
                    <tr>
                        <td>${p.name}</td>
                        <td>${p.category}</td>
                        <td>${p.price}</td>
                        <td>${stockDisplay}</td>
                        <td><button class="btn-red" onclick="del('${d.id}')">Hapus</button></td>
                    </tr>
                `;
            });
        });

        window.del = async(id) => { if(confirm("Hapus?")) await deleteDoc(doc(db, "products", id)); };
    </script>
</body>
</html>
